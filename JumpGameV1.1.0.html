<!DOCTYPE html>
<html>
    <head>
        <style>
            canvas {
                border: 3px solid #000;
                background: url('data:image/gif;base64,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');
                width:  100%;
                aspect-ratio: 1 / 1;
                overflow: hidden;
            }
        </style>
    </head>
    <body>
        <canvas id="canvas"></canvas>
        <script>
            const d = document.getElementById("canvas");
            const c = d.getContext("2d");

            class Score {
                constructor() {
                    this.score = 0;
                    this.position = 20;
                }

                get() {
                    return this.score;
                }

                set(x) {
					if (x > this.score){
						this.score = x;
					}
                }

                display(scale) {
                    c.fillText(
                        `Score: ${this.score}`,
                        this.position * scale,
                        this.position * scale
                    );
                }
            }

            class Platform {
                constructor(x, y) {
                    this.x = x;
                    this.y = y;
                }

                display(scale, playerHeight) {
                    c.fillRect(
                        this.x * scale,
                        (this.y + playerHeight) * scale,
                        w.platformWidth * scale,
                        w.platformHeight * scale
                    );
                }
            }

            class Player {
                constructor(maxX, maxY, lowestPlatform) {
                    this.x = maxX / 2;
                    this.y = maxY / 2;
                    this.relativeX
                    this.size = maxX / 30;          // may have issues when size converting
                    this.middle = this.size / 2;
                    this.height = 0;
                    this.dy = 8;
                    this.heightToPlatY = maxY / 2 - lowestPlatform;
                }

                display(scale) {
                    const scaledSize = this.size * scale;

                    c.fillRect(
                        this.x - (scaledSize / 2),
                        (this.y - this.size) * scale,
                        scaledSize,
                        scaledSize
                    );
                }

                setPosition(x) {
                    this.x = x;
                    this.relativeX = x / scaleValue;
                }

				isPlayerOnPlatformY(platformDif) {
					return (this.height + this.heightToPlatY) % platformDif === 0;  // returns bool
				}

				onWhichPlatformY(platformDif) {
					return (this.height + this.heightToPlatY) / platformDif;  // returns index
				}

                isPlayerOnPlatformX(platform) {
                    return (this.relativeX  + this.middle >= platform.x     // is player within left side
                        && this.relativeX - this.middle <= platform.x + w.platformWidth);     // is player within right side
                }

                isPlayerOnPlatform(platformDif, platforms) {
                    return this.isPlayerOnPlatformX(platforms[this.onWhichPlatformY(platformDif)]);
                }

                jump(platformDif, platforms) {
					if ((this.isPlayerOnPlatformY(platformDif) && this.isPlayerOnPlatform(platformDif, platforms))
					    || this.height <= 0) {
						this.dy = 9;
						this.height += 10;
					} else if (this.dy > 0) {
						this.height += this.dy;
						this.dy--;
					}
                }

				gravity(platformDif, platforms) {
					if((this.isPlayerOnPlatformY(platformDif) && !this.isPlayerOnPlatform(platformDif, platforms))
					    || (this.height > 0 && !this.isPlayerOnPlatformY(platformDif))) {
						this.height--;
					}
				}

            }

            class StartLine {
                constructor(maxX, maxY) {
                    this.y = maxY / 2;
                    this.width = maxX;
                    this.height = 2;
                }

                display(scale, playerHeight) {
                    c.fillRect(
                        0,
                        (this.y + playerHeight) * scale,
                        this.width * scale,
                        this.height * scale
                    );
                }
            }

            class World {
                constructor() {
                    this.maxX = 300;
                    this.maxY = 300;
					this.platformQuantity = 10;
					this.platformDif = this.maxY / this.platformQuantity;
                    this.platforms = [];
                    this.addPlatform(this.maxY - this.maxY / this.platformQuantity / 2);    // lowest platform
                    this.lowestPlatform = this.maxY - this.platforms[0].y;
                    this.platformWidth = 20;
                    this.platformHeight = 2;

                    this.score = new Score();
                    this.startLine = new StartLine(this.maxX, this.maxY);
                    this.player = new Player(this.maxX, this.maxY, this.lowestPlatform);

                    while (this.getLastPlatform().y > 0) {
                        this.addPlatform(this.getLastPlatform().y - this.platformDif);
                    }
                }

                getLastPlatform() {
                    return this.platforms[this.platforms.length - 1];
                }

                addPlatform(y) {
                    this.platforms.push(
                        new Platform(
                            Math.floor(Math.random() * (this.maxX - this.platformWidth)),
                            y
                        )
                    );
                }

                display(scale) {
                    this.player.display(scale);
                    this.score.display(scale);

                    for (const platform of this.platforms) {
                        platform.display(scale, this.player.height);
                    }

                    if (this.player.height <= this.maxY / 2) {
                        this.startLine.display(scale, this.player.height);
                    }
                }

            }

            const w = new World();

            const scaleValue = d.getBoundingClientRect().width / w.maxX;

            function game() {setTimeout(() => {
                // clears the screen
                c.clearRect(
                    0,
                    0,
                    d.clientWidth,
                    d.clientHeight
                );

                // generate more terrain
                if (w.getLastPlatform().y + w.player.height >= w.platformDif) {
                    w.addPlatform(w.getLastPlatform().y - w.platformDif);
                }

				w.score.set(w.player.height);
				w.player.gravity(w.platformDif, w.platforms);

                w.display(scaleValue);

                requestAnimationFrame(game);
            }, 1)}

            function main() {
                // sets canvas width and height
                d.width = d.clientWidth;
                d.height = d.clientHeight;

                c.font = `${10 * scaleValue}px Arial`;

                document.addEventListener(
                    'pointermove',
                    e => w.player.setPosition(e.offsetX)
                );

                document.addEventListener(
                    'keydown',
                    e => {
                        if (e.key === ' ') w.player.jump(w.platformDif, w.platforms);
                    }
                );

                game();
            }
            main();
        </script>
    </body>
</html>